# 3Dフライトシミュレータ 要件定義

## 1. 目的
8bit時代の雰囲気を持つ、コックピット視点の3Dワイヤーフレーム・フライトシミュレータをWebブラウザで提供する。

## 2. 背景
- 初心者でも気軽に飛行体験できる軽量ゲームが必要
- 東京都心の地形を飛行対象にし、視覚的な楽しさを重視
- デプロイ先はVercel

## 3. 対象ユーザー
- フライトシム初心者
- レトロCG表現が好きなユーザー
- PCブラウザで短時間プレイしたいユーザー

## 4. スコープ
### 4.1 In Scope
- 3Dワイヤーフレーム描画（地形・建物・機体）
- コックピット視点固定
- キーボード操作のみ
- プロペラ機（セスナ相当）の簡易飛行モデル
- 東京都心部データを利用した飛行
- 離陸/着陸なし（空中スタート）
- 設定保存（感度・画質・キー割当）
- エラー表示と復旧導線

### 4.2 Out of Scope
- フォトリアル描画
- マルチプレイ
- VR対応
- ATCやミッションシナリオ
- 本格的な空力解析

## 5. 機能要件
### FR-01 3D表示
- ワイヤーフレームで地形と建造物を表示できる
- FPS 30以上を目標とする（標準ノートPC）

### FR-02 フライト操作
- ピッチ、ロール、ヨー、スロットルをキーボードで操作できる
- 自動復元（軽い安定化）を持つ初心者向け挙動

### FR-03 ゲームループ
- 一時停止/再開ができる
- 衝突判定（地面/建物）後にリスポーンできる

### FR-04 HUD
- 高度、速度、方位、姿勢、スロットルを表示する
- 警告（失速接近、地面接近）を表示する

### FR-05 データ利用
- 国交省3D都市モデル（PLATEAU）由来の東京都心データを利用する
- ライセンス表記と出典リンクを表示する

### FR-06 設定永続化
- 設定はローカルストレージに保存し次回起動時に復元する

### FR-07 障害対応
- 地形読み込み失敗時に再試行可能なエラーUIを表示する
- 致命的例外時にセーフモード（地形なしテスト空間）で起動可能

### FR-08 機体スペック（固定）
- 機体タイプ: Cessna 172相当（単発プロペラ）
- 巡航速度: 55 m/s（約107 kt）
- 失速速度: 24 m/s（約47 kt）
- 最大バンク角（ゲーム制限）: 60 deg
- 初期スポーン高度: 地表から 1200 m
- 初期スポーン速度: 45 m/s
- スロットル範囲: 0.0 - 1.0

## 6. 非機能要件
- 対応ブラウザ: 最新のChrome/Safari/Edge
- 初回ロード目標: 5秒以内（ブロードバンド）
- 操作入力遅延: 100ms未満
- Vercelでの静的配信+必要最小限のServerless API

## 7. 制約
- 技術: TypeScript + Next.js (App Router) + Three.js
- MVC分離を厳守する
- Controllerは薄く保ち、ビジネスロジックはModelに集約する
- Viewで業務ロジックを持たない

## 8. 受け入れ基準
- 起動後すぐに東京都心上空で飛行できる
- キーボードのみで5分以上継続プレイ可能
- 衝突時にリスポーンし、再度飛行継続できる
- 設定変更が再読み込み後も保持される
- ライセンス表記が画面内から確認できる

## 9. 既知の実装ギャップ（2026-02-07時点）
- 描画入力は `public/terrain/sample_tokyo_wireframe.json`（`source: plateau-13103-minato-ku-2023-v4-real`）へ移行済み。
- インフラ種別の描画レイヤー基盤は実装済み（`building/road/bridge/railway/water` 出力確認済み）。
- セーフモード起動は実装済み（地形ロード失敗オーバーレイの `SAFE MODE` ボタン、`?safeMode=1` 起動）。
- 実PLATEAUデータでの表示品質検証（道路密度・橋梁形状・河川連続性）は未完了。
- 解決タスクと完了判定は `docs/tasks.md` の「現状課題（2026-02-07確認）」を正とする。
